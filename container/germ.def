Bootstrap: library
From: ubuntu:21.04

##############################
# test
##############################
%runscript
    echo "Container was created $NOW"
    nextflow run \
        /germ/nextflow/scripts/test.nf \
        --prefix $PREFIX \
        --r1 $R1 \
        --r2 $R2

%labels test
    Author cfibke@hotmail.com
    Version v0.0.1

%help test
    This is the help for BASE.

##############################
# Global options
##############################
%post
    #Installing all base dependencies
    apt-get update && apt-get -y upgrade
    apt-get -y install \
    build-essential \
    wget \
    bzip2 \
    ca-certificates \
    libglib2.0-0 \
    libxext6 \
    libsm6 \
    libxrender1 \
    default-jdk \
    unzip \
    git
    rm -rf /var/lib/apt/lists/*
    apt-get clean


    #Installing Miniconda 3
    touch .condarc
    wget -c https://repo.anaconda.com/miniconda/Miniconda3-4.7.10-Linux-x86_64.sh
    /bin/bash Miniconda3-4.7.10-Linux-x86_64.sh -bfp /usr/local

    #Conda configuration of channels from .condarc file
    conda config --file /.condarc --add channels bioconda
    conda config --file /.condarc --add channels conda-forge

    #Install nextflow
    mkdir /software
    wget -qO- https://get.nextflow.io | bash
    mv nextflow /software
    chmod 755 /software/nextflow

    #Install databases
    mkdir /db
    wget --directory-prefix=/db https://gembox.cbcb.umd.edu/mash/refseq.genomes.k21s1000.msh
    wget --directory-prefix=/db https://data.ace.uq.edu.au/public/gtdb/data/releases/release202/202.0/bac120_taxonomy_r202.tsv

%environment
    export PATH=$PATH:/software
